<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Email Database</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- Fixed Header -->
  <header class="header">
    <h1>Email Database</h1>
    <button class="back-button" onclick="window.location.href='dashboard.html'">Back to Dashboard</button>
  </header>

  <!-- Scrollable Form Container -->
  <div class="form-container">
    <div class="top-controls">
      <input type="text" id="searchInput" placeholder="Search by Store, Sub Owner, Key Account, Grade, Retail/On Premise">
      <button id="sendEmailButton" disabled>Send Email</button>
    </div>

    <div id="storeList" class="store-list">
      <!-- Store list will be populated here by JS -->
    </div>
  </div>

  <!-- Fixed Footer -->
  <footer class="footer">
    <p>RC Beverages Portal</p>
  </footer>

  <script src="emaildatabase.js"></script>

</body>
</html>
// emaildatabase.js

// Your API endpoint (Master Store List)
const apiUrl = "https://sheetdb.io/api/v1/8ba1eug88u4y1"; // <-- Confirm this is your latest Master Store List

// Store the fetched store data
let stores = [];

// Fetch data on load
window.onload = function() {
  fetchStores();
};

function fetchStores() {
  fetch(apiUrl)
    .then(response => response.json())
    .then(data => {
      // Filter stores with an Email
      stores = data.filter(store => store.Email && store.Email.trim() !== "");
      renderStores(stores);
    })
    .catch(error => console.error('Error fetching store data:', error));
}

function renderStores(storeArray) {
  const storeList = document.getElementById('storeList');
  storeList.innerHTML = "";

  storeArray.forEach((store, index) => {
    const storeItem = document.createElement('div');
    storeItem.className = 'store-item';

    storeItem.innerHTML = `
      <input type="checkbox" class="store-checkbox" data-email="${store.Email}" id="store-${index}">
      <label for="store-${index}">
        <strong>${store['Store Name']}</strong> | 
        ${store['Sub Owner Group']} | 
        ${store['Key Account Group']} | 
        ${store['Grade']} | 
        ${store['Retail / On Premise']}
      </label>
    `;

    storeList.appendChild(storeItem);
  });

  setupCheckboxListener();
}

// Search functionality
document.getElementById('searchInput').addEventListener('input', function(e) {
  const searchTerm = e.target.value.toLowerCase();
  const filteredStores = stores.filter(store =>
    (store['Store Name'] && store['Store Name'].toLowerCase().includes(searchTerm)) ||
    (store['Sub Owner Group'] && store['Sub Owner Group'].toLowerCase().includes(searchTerm)) ||
    (store['Key Account Group'] && store['Key Account Group'].toLowerCase().includes(searchTerm)) ||
    (store['Grade'] && store['Grade'].toLowerCase().includes(searchTerm)) ||
    (store['Retail / On Premise'] && store['Retail / On Premise'].toLowerCase().includes(searchTerm))
  );
  renderStores(filteredStores);
});

// Enable/Disable Send Email button based on selection
function setupCheckboxListener() {
  const checkboxes = document.querySelectorAll('.store-checkbox');
  checkboxes.forEach(checkbox => {
    checkbox.addEventListener('change', function() {
      const anyChecked = Array.from(checkboxes).some(c => c.checked);
      document.getElementById('sendEmailButton').disabled = !anyChecked;
    });
  });
}

// Send email button logic
document.getElementById('sendEmailButton').addEventListener('click', function() {
  const selectedEmails = Array.from(document.querySelectorAll('.store-checkbox:checked'))
    .map(checkbox => checkbox.getAttribute('data-email'));

  if (selectedEmails.length > 0) {
    const mailtoLink = `mailto:?bcc=${encodeURIComponent(selectedEmails.join(','))}`;
    window.location.href = mailtoLink;
  }
});
/* --- Email Database Page Specific --- */

.top-controls {
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  padding: 10px;
}

.top-controls input[type="text"] {
  flex: 1;
  padding: 10px;
  margin-right: 10px;
  font-size: 16px;
  border: 1px solid #ccc;
  border-radius: 8px;
}

.top-controls button {
  padding: 10px 20px;
  font-size: 16px;
  border: none;
  border-radius: 8px;
  background-color: #007bff;
  color: white;
}

.top-controls button:disabled {
  background-color: #ccc;
  cursor: not-allowed;
}

.store-list {
  margin-top: 10px;
}

.store-item {
  display: flex;
  align-items: center;
  padding: 10px;
  border-bottom: 1px solid #eee;
  font-size: 16px;
}

.store-item input[type="checkbox"] {
  margin-right: 10px;
  transform: scale(1.3);
}
