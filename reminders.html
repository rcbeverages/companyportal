<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Reminders</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="header">
    <h1>Reminders</h1>
  </header>

  <div class="sub-header">
    <button onclick="window.location.href='dashboard.html'" class="back-button">Back to Dashboard</button>
  </div>

  <div class="form-container">
    <div class="button-section">
      <button class="add-button" onclick="openAddReminder()">+ Add New Reminder</button>
    </div>

    <div id="reminderList" class="reminder-list">
      <!-- Reminders will be inserted here dynamically -->
    </div>
  </div>

  <footer class="footer">
    <p>RC Beverages Portal</p>
  </footer>

  <!-- Add Reminder Popup -->
  <div id="addReminderPopup" class="popup">
    <div class="popup-content">
      <h2>Add New Reminder</h2>
      <form id="addReminderForm">
        <label for="reminderDate">Date to Email:</label>
        <input type="date" id="reminderDate" name="reminderDate" required>

        <label for="reminderCustomer">Select Customer:</label>
        <select id="reminderCustomer" name="reminderCustomer" required></select>

        <label for="reminderComments">Comments:</label>
        <textarea id="reminderComments" name="reminderComments" rows="4" required></textarea>

        <div class="popup-buttons">
          <button type="submit" class="save-button">Save Reminder</button>
          <button type="button" class="cancel-button" onclick="closeAddReminder()">Cancel</button>
        </div>
      </form>
    </div>
  </div>
  <script>
    const remindersApiUrl = 'https://sheetdb.io/api/v1/lkhkbez8p8el9';
    const customersApiUrl = 'https://sheetdb.io/api/v1/8ba1eug88u4y1'; // Master Store List

    // Fetch and display reminders
    async function loadReminders() {
      try {
        const response = await fetch(remindersApiUrl);
        const data = await response.json();

        // Sort reminders by date ascending
        data.sort((a, b) => new Date(a.Date_to_Email) - new Date(b.Date_to_Email));

        const reminderList = document.getElementById('reminderList');
        reminderList.innerHTML = '';

        data.forEach(reminder => {
          if (reminder.Customer_Name && reminder.Date_to_Email) {
            const reminderItem = document.createElement('div');
            reminderItem.className = 'reminder-item';
            reminderItem.innerHTML = `
              <h3>${reminder.Customer_Name}</h3>
              <p><strong>Date to Email:</strong> ${reminder.Date_to_Email}</p>
              <p><strong>Comments:</strong> ${reminder.Comments || ''}</p>
            `;
            reminderList.appendChild(reminderItem);
          }
        });
      } catch (error) {
        console.error('Error loading reminders:', error);
      }
    }

    // Open the Add Reminder popup
    function openAddReminder() {
      document.getElementById('addReminderPopup').style.display = 'block';
      loadCustomersDropdown();
    }

    // Close the Add Reminder popup
    function closeAddReminder() {
      document.getElementById('addReminderPopup').style.display = 'none';
      document.getElementById('addReminderForm').reset();
    }

    // Load customers into dropdown
    async function loadCustomersDropdown() {
      try {
        const response = await fetch(customersApiUrl);
        const data = await response.json();
        const customerDropdown = document.getElementById('reminderCustomer');
        customerDropdown.innerHTML = '';

        data.forEach(customer => {
          if (customer.Customer_Name) {
            const option = document.createElement('option');
            option.value = customer.Customer_Name;
            option.text = customer.Customer_Name;
            customerDropdown.appendChild(option);
          }
        });
      } catch (error) {
        console.error('Error loading customers:', error);
      }
    }
    // Handle form submission
    document.getElementById('addReminderForm').addEventListener('submit', async function(event) {
      event.preventDefault();

      const date = document.getElementById('reminderDate').value;
      const customer = document.getElementById('reminderCustomer').value;
      const comments = document.getElementById('reminderComments').value;

      const reminderData = {
        Date_to_Email: date,
        Customer_Name: customer,
        Comments: comments
      };

      try {
        await fetch(remindersApiUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ data: [reminderData] }),
        });

        closeAddReminder();
        loadReminders();
      } catch (error) {
        console.error('Error saving reminder:', error);
      }
    });

    // Load reminders when page loads
    window.onload = function() {
      loadReminders();
    }
  </script>
</body>
</html>
